- name: Skip manage_esxi in stub mode
  ansible.builtin.meta: end_play
  when: manage_esxi_stub_mode | bool

- name: Preconfigure base ESXi
  ansible.builtin.include_tasks: preconfig.yml

- name: Configure portgroups
  ansible.builtin.include_tasks: portgroups.yml

- name: Setup base ESXi
  ansible.builtin.include_tasks: base.yml

- name: Configure firewall
  ansible.builtin.include_tasks: firewall.yml

- name: Manage users
  ansible.builtin.include_tasks: users.yml

# TODO:
# - name: Mount VMFS datastores to ESXi
#   community.vmware.vmware_host_datastore:
#     hostname: "{{ manage_esxi_vcenter_hostname }}"
#     username: "{{ manage_esxi_vcenter_username }}"
#     password: "{{ manage_esxi_vcenter_password }}"
#     validate_certs: "{{ manage_esxi_validate_certs }}"
#     datastore_name: '{{ item.name }}'
#     datastore_type: '{{ item.type }}'
#     vmfs_device_name: 'naa.XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX'
#     vmfs_version: 6
#     esxi_hostname: "{{ manage_esxi_esxi_hostname }}"
#     state: present
#   delegate_to: localhost
