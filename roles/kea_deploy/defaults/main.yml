---
# Podman runtime
kea_deploy_pod_name: "kea"
kea_deploy_pod_manifest_path: "/etc/podman/pods/kea.yml"
kea_deploy_image: "docker.io/iscproject/kea:2.5.4"
kea_deploy_container_name: "{{ kea_deploy_pod_name }}-kea"
kea_deploy_run_as_user: 0
kea_deploy_run_as_group: 0
kea_deploy_run_as_non_root: false
kea_deploy_install_packages: true
kea_deploy_selinux_relabel: false

# Host paths (mounted into container)
kea_deploy_host_config_dir: "/srv/kea/config"
kea_deploy_host_config_path: "{{ kea_deploy_host_config_dir }}/kea-dhcp4.conf"
kea_deploy_host_data_dir: "/srv/kea/data"

# Container paths
kea_deploy_container_config_path: "/etc/kea/kea-dhcp4.conf"
kea_deploy_container_data_dir: "/var/lib/kea"

# DHCPv4 service
kea_deploy_dhcp4_port: 67
kea_deploy_host_dhcp4_port: "{{ kea_deploy_dhcp4_port }}"
kea_deploy_host_ip: >-
  {{
    ansible_default_ipv4.address
      | default(ansible_all_ipv4_addresses[0] | default('127.0.0.1'))
  }}

# Optional health check URL (Control Agent, if configured)
kea_deploy_health_url: ""
kea_deploy_health_url_effective: "{{ kea_deploy_health_url }}"
kea_deploy_validate_certs: true

# Kea DHCPv4 config content
kea_deploy_config: |
  {
    "Dhcp4": {
      "interfaces-config": {
        "interfaces": ["*"]
      },
      "lease-database": {
        "type": "memfile",
        "persist": true,
        "name": "{{ kea_deploy_container_data_dir }}/kea-leases4.csv"
      },
      "valid-lifetime": 4000,
      "renew-timer": 1000,
      "rebind-timer": 2000,
      "subnet4": []
    }
  }

# Deployment control
kea_deploy_manage_service: true
kea_deploy_manage_systemd: "{{ kea_deploy_manage_service }}"
kea_deploy_systemd_unit_name: >-
  {{
    'podman-kube@'
    ~ (kea_deploy_pod_manifest_path | basename | regex_replace('\\.yml$', ''))
    ~ '.service'
  }}
kea_deploy_skip_runtime: false
kea_deploy_skip_deploy: false
kea_deploy_skip_config: false
kea_deploy_skip_validate: false
