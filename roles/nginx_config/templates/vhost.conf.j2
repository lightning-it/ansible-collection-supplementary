server {
  listen {{ item.listen_port | default(nginx_deploy_listen_port) }};
  server_name {{ item.server_name | default('_') }};

  root {{ item.root | default(nginx_deploy_root) }};
  index {{ (item.index_files | default(nginx_deploy_index_files)) | join(' ') }};

{% if item.extra_directives is defined and item.extra_directives | length > 0 %}
{% for directive in item.extra_directives %}
  {{ directive }}
{% endfor %}
{% endif %}

{% if item.locations is defined and item.locations | length > 0 %}
{% for location in item.locations %}
  location {{ location.path | default('/') }} {
{% for directive in location.directives | default([]) %}
    {{ directive }}
{% endfor %}
  }
{% endfor %}
{% endif %}
}
