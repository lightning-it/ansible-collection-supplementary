user {{ nginx_deploy_user }};
worker_processes {{ nginx_deploy_worker_processes }};
error_log {{ nginx_deploy_log_dir }}/error.log warn;
pid {{ nginx_deploy_pid_file }};

worker_rlimit_nofile {{ (nginx_deploy_worker_connections | int) * 2 }};

events {
  worker_connections {{ nginx_deploy_worker_connections }};
}

http {
  include {{ nginx_deploy_conf_dir }}/mime.types;
  default_type application/octet-stream;

  log_format main '$remote_addr - $remote_user [$time_local] "$request" '
                  '$status $body_bytes_sent "$http_referer" '
                  '"$http_user_agent" "$http_x_forwarded_for"';

  access_log {{ nginx_deploy_log_dir }}/access.log main;

  sendfile {{ (nginx_deploy_sendfile | bool) | ternary('on', 'off') }};
  tcp_nopush {{ (nginx_deploy_tcp_nopush | bool) | ternary('on', 'off') }};
  tcp_nodelay {{ (nginx_deploy_tcp_nodelay | bool) | ternary('on', 'off') }};
  keepalive_timeout {{ nginx_deploy_keepalive_timeout }};
  types_hash_max_size {{ nginx_deploy_types_hash_max_size }};
  server_tokens {{ nginx_deploy_server_tokens }};

{% if nginx_deploy_http_extra_directives is defined and nginx_deploy_http_extra_directives | length > 0 %}
{% for directive in nginx_deploy_http_extra_directives %}
  {{ directive }}
{% endfor %}
{% endif %}

  include {{ nginx_deploy_conf_d_dir }}/*.conf;
}
